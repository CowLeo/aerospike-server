#!/bin/bash

EDITION=${1:-community}
BUILD_OS=${2:-unknown}
ALL_FEATURES=( "${@:3}" )
for FEATURE in "${ALL_FEATURES[@]}"
do
   if [[ "$FEATURE" =~ ^USE_.*=1 ]]; then
      feature=`echo $FEATURE | sed 's/USE_\([A-Z]*\)=1/\1/' | tr [A-Z] [a-z]`
      case "$feature" in
         xdr)
            FEATURES="$FEATURES"";$feature";;
      esac
   fi
done

echo "////
//// AUTOMATICALLY GENERATED BY BUILD SYSTEM
////
const char aerospike_build_id[] = \"`git describe`\";
const char aerospike_build_time[] = \"`date`\";
const char aerospike_build_type[] = \"Aerospike ${EDITION^} Edition\";
const char aerospike_build_os[] = \"${BUILD_OS}\";
const char aerospike_build_features[] = \"${FEATURES}\";
"
